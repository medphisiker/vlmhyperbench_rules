# Правила разработки (v0.2.0)

## Принципы архитектуры
1.  **Async-First**: Все сетевые вызовы (API Wrapper, DB, WebSockets) должны быть асинхронными.
2.  **BFF (Backend for Frontend)**: Backend подготавливает данные для визуализации (Plotly JSON) на стороне сервера.
3.  **Strict Validation**: Любой структурированный вывод модели должен валидироваться через Pydantic v2.
4.  **Dynamic Composition**: Зависимости плагинов разрешаются динамически через реестры, а не через статические workspaces.

## Workflow разработки (Playground -> Production)

### 1. Этап Playground (Прототипирование)
*   **Где**: Текущий репозиторий `vlmhyperbench_playground`.
*   **Что делаем**:
    *   Реализуем базовые абстрактные классы и компоненты ядра.
    *   Код пишется в режиме `dev` (editable packages).

### 2. Этап Integration (Подключение модулей)
*   **Что делаем**:
    *   Используем **динамическую композицию** вместо Git Submodules.
    *   Пакеты плагинов (датасеты, метрики) живут в независимых репозиториях.
    *   Для разработки в `dev` режиме клонируем репозиторий пакета в любую локальную папку и прописываем путь в `.dev.yaml` оверлее реестра.
    *   Оркестратор автоматически устанавливает такие пакеты в **editable** режиме (`pip install -e`).

### 3. Этап Pipeline & Testing
*   **Что делаем**:
    *   Прогоняем полный пайплайн (Inference -> Eval -> Report) на тестовых данных.
    *   Исправляем баги как в ядре, так и в подключаемых модулях.

### 4. Этап Release (Фиксация версий)
*   **Что делаем**:
    *   Пушим работающие версии кода в репозитории пакетов.
    *   Создаем git tags (например, `v0.1.0`).
    *   В YAML-реестрах обновляем ссылки на конкретные теги (`type: git, ref: v0.1.0`).
    *   Это гарантирует 100% воспроизводимость экспериментов в `prod` режиме.

## Работа с зависимостями (uv)
*   **Версия Python**: Используем **Python 3.13+** для всех компонентов.
*   **Пакетный менеджер**: Используем **uv 0.9.26** для управления окружениями и зависимостями.
*   **Система сборки**: Используем **uv.build** в качестве бэкенда сборки для всех новых пакетов.
*   **RUN_MODE**:
    *   `RUN_MODE=dev`: Используются локальные пути из `.dev.yaml` оверлеев.
    *   `RUN_MODE=prod`: Используются стабильные версии из базовых `.yaml` файлов.

## Работа с индексом кода (Code Index)
*   Используйте `refresh_index` и `build_deep_index` для поддержания актуальности базы знаний.

## Обновление базы знаний (Memory Bank)
*   После успешного завершения задачи ОБЯЗАТЕЛЬНО обновляйте соответствующие файлы в `.kilocode/rules/`.